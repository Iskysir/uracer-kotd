#ifdef GL_ES
#define LOWP lowp
#define MED mediump
precision mediump float;
#else
#define LOWP
#define MED
#endif
uniform MED sampler2D u_texture0;
uniform MED sampler2D u_texture1;
uniform float BloomIntensity;
uniform float OriginalIntensity;

varying vec2 v_texCoords;

const vec3 GRAYSCALE = vec3(0.3, 0.59, 0.11);

// 0 = totally desaturated
// 1 = saturation unchanged
// higher = increase saturation
const float BaseSat = 1;
const float BloomSat = 1;

vec4 adjustSaturation(vec4 color, float saturation)
{
	// The constants 0.3, 0.59, and 0.11 are chosen because the
	// human eye is more sensitive to green light, and less to blue.
	float grey = dot(color, GRAYSCALE);
	return lerp(grey, color, saturation);
}

void main()
{
	// lookup original and base
	vec4 original = texture2D(u_texture0, v_texCoords);
	vec4 bloom = texture2D(u_texture1, v_texCoords);

	// adjust color saturation and intensity
	original = adjustSaturation(original,BaseSat) * OriginalIntensity;
	bloom = adjustSaturation(bloom,BloomSat) * BloomIntensity;

	// darken the base image in areas there there is a lot of bloom
	// to prevent things looking excessively burned-out
	original *= (1.0 - saturate(bloom));

	// combine
	gl_FragColor = original + bloom;
}